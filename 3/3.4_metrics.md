# 监控项说明

nomad原生metrics可访问：`http://127.0.0.1:4646/v1/metrics?format=prometheus`

由于nomad plugin并不能访问nomad监控接口，dtle有关的监控需要通过API兼容层访问。

首先配置nomad.hcl中打开api兼容层，并配置`publish_metrics = true`。

```
plugin "dtle" {
  config {
    api_addr = "127.0.0.1:8190"
    nomad_addr = "127.0.0.1:4646"
    publish_metrics = true
    stats_collection_interval = 15
    ...
```

访问 `127.0.0.1:8190/metrics` 可查看监控项，或在prometheus中配置从此地址获取监控项。

| 类别  | 监控项 | 
| ------------- | ------------- | 
| 网络流量状态 | - |
| - | network.in_msgs |
| - | network.out_msgs |
| - | network.in_bytes |
| - | network.out_bytes |
| 缓存/队列状态 | - |
| - | buffer.src_queue_size	|
| - | buffer.dest_group_queue_size |
| - | buffer.dest_queue_size |
| - | buffer.send_by_timeout |
| - | buffer.send_by_size_full |
| 表统计（未实现） | - |
| - | table.insert |
| - | table.update |
| - | table.delete |
| 延迟统计（未实现） | - |
| - | delay.num	|
| - | delay.time |
| 吞吐统计（未实现） | - |
| - | throughput.num |
| - | throughput.time |
